---
description: 项目上下文更新 - 基于项目变更智能更新相关上下文文档
argument-hint: [--auto] [--interactive]
---

## 功能
分析项目自上次更新以来的变更，智能识别需要更新的上下文文件，并进行有针对性的更新。

## 变更检测策略
### Git 变更分析
1. **提交历史**：分析最近的提交信息和变更
2. **文件变更**：检测新增、修改、删除的文件
3. **依赖变更**：监控 package.json、requirements.txt 等变更
4. **配置变更**：检测配置文件的修改

### 项目状态分析
1. **版本变化**：检测版本号更新
2. **结构变化**：检测目录结构调整
3. **技术栈变化**：检测新技术或框架的引入
4. **进展更新**：检测功能完成或里程碑达成

## 更新流程
1. **变更扫描**：全面扫描项目变更
2. **影响分析**：确定哪些上下文文件需要更新
3. **更新策略**：制定具体的更新方案
4. **执行更新**：对目标文件进行精确更新
5. **验证和总结**：验证更新结果并生成报告

## 智能更新规则
### project-overview.md
- **触发条件**：README 更新、版本变更、主要功能增加
- **更新内容**：项目描述、版本信息、功能列表

### tech-context.md  
- **触发条件**：依赖变更、新技术引入、架构调整
- **更新内容**：技术栈列表、架构信息、依赖版本

### project-structure.md
- **触发条件**：目录结构变更、新模块添加
- **更新内容**：目录树、组件关系、模块描述

### progress.md
- **触发条件**：功能完成、里程碑达成、版本发布
- **更新内容**：进展状态、完成的功能、下一步计划

### decisions.md
- **触发条件**：重大技术变更、架构调整
- **更新内容**：新的技术决策记录

## 更新模式
### 自动模式 (--auto)
- 基于变更自动更新明确的信息
- 安全的批量更新操作
- 生成详细的更新日志

### 交互模式 (--interactive)  
- 逐个确认每项更新
- 允许手动编辑更新内容
- 提供更新建议和选项

### 混合模式（默认）
- 自动更新明确信息
- 交互确认重要变更
- 平衡效率和控制

## 更新算法
1. **变更权重计算**：评估每个变更的重要性
2. **关联分析**：识别变更对不同上下文文件的影响
3. **冲突检测**：检测可能的信息冲突
4. **增量更新**：只更新变化的部分，保留其他内容
5. **版本追踪**：更新文件的 frontmatter 时间戳

## 更新摘要格式
```
🔄 项目上下文更新完成

📊 检测到的变更:
   • 3 个文件修改
   • 2 个新依赖添加  
   • 1 个新功能完成
   • 版本从 v1.2.0 → v1.3.0

📝 更新的上下文文件:
   ✅ project-overview.md - 版本和功能更新
   ✅ tech-context.md - 新依赖和技术栈
   ✅ progress.md - 功能完成状态
   ⏭️  project-structure.md - 无需更新

⏰ 更新时间: [时间戳]
```

## 最佳实践
- **定期更新**：建议在每个开发周期后更新
- **重大变更**：架构调整时手动检查更新质量
- **团队协作**：更新后通知团队成员
- **备份策略**：重要更新前创建备份

## 错误处理
- **冲突解决**：提供冲突信息的解决建议
- **回滚机制**：支持撤销错误的更新
- **增量恢复**：部分更新失败时的恢复策略
- **数据保护**：防止意外覆盖重要信息

---